<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.83.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Running Rings Around Plain Java - The Killer Code &middot; Chase the Devil</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://chasethedevil.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://chasethedevil.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://chasethedevil.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://chasethedevil.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">
<link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://chasethedevil.github.io/"><h1 style="font-family: 'UnifrakturMaguntia', cursive;font-weight: normal;">Chase the Devil</h1></a>
      <p class="lead">
       A personal, independent, technical blog 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://chasethedevil.github.io/">Blog</a> </li>
        <li><a href="/about/"> About </a></li><li><a href="/post/"> Posts </a></li>
      </ul>

        <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <script type="text/javascript">document.write("<a href=\"mail" + "to:" + new Array("fabien","2ipi.com").join("@") + "?subject=your%20blog\">" + '<i class="fa fa-envelope fa-3x"></i>' + "</" + "a>");</script>
      
      
      
      
      
      
      <a href="https://twitter.com/logos01"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="https://chasethedevil.github.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>
 </nav>

    <p>&copy; 2021. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Running Rings Around Plain Java - The Killer Code</h1>
  <time datetime=2009-01-08T13:21:00Z class="post-date">Thu, Jan 8, 2009</time>
  <p>I wrote my <!-- raw HTML omitted -->previous<!-- raw HTML omitted --> post too fast. I found a very simple change that increases the speed x6!<!-- raw HTML omitted --><!-- raw HTML omitted -->The idea is too process messages in a ThreadPoolExecutor. As my Nodes are Runnable, I just needed to initialize a common ThreadPoolExecutor, and in a sendMessage, execute the runnable each time.<!-- raw HTML omitted --><!-- raw HTML omitted -->Here is the full code:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> OptimizedRing {<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> ExecutorService executor;<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> main(String[] args) <!-- raw HTML omitted --><!-- raw HTML omitted -->throws<!-- raw HTML omitted --><!-- raw HTML omitted --> Exception {<!-- raw HTML omitted -->        OptimizedRing ring = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> OptimizedRing();<!-- raw HTML omitted -->        RingNode node = ring.startRing(Integer.parseInt(args[<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->]));<!-- raw HTML omitted -->        node.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> StartMessage());<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode startRing(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> n) {<!-- raw HTML omitted -->        RingNode[] nodes = spawnNodes(n, startTimer());<!-- raw HTML omitted -->        connectNodes(n, nodes);<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> nodes[<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->];<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer startTimer() {<!-- raw HTML omitted -->        Timer timer = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer();<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> Thread(timer).start();<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> timer;<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode[] spawnNodes(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> n, <!-- raw HTML omitted --><!-- raw HTML omitted -->final<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer timer) {<!-- raw HTML omitted -->        System.out.println(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;constructing nodes&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->long<!-- raw HTML omitted --><!-- raw HTML omitted --> start = System.currentTimeMillis();<!-- raw HTML omitted -->        executor = Executors.newFixedThreadPool(<!-- raw HTML omitted --><!-- raw HTML omitted -->4<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        RingNode[] nodes = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode[n+<!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->];<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->for<!-- raw HTML omitted --><!-- raw HTML omitted --> (<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> i = <!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->; i &lt; n ; i++) {<!-- raw HTML omitted -->            nodes[i] = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode(i, timer, <!-- raw HTML omitted --><!-- raw HTML omitted -->null<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->long<!-- raw HTML omitted --><!-- raw HTML omitted --> end = System.currentTimeMillis();<!-- raw HTML omitted -->        System.out.println(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Took &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+(end-start)+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;ms to construct &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+n+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; nodes&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> nodes;<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> connectNodes(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> n, RingNode[] nodes) {<!-- raw HTML omitted -->        System.out.println(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;connecting nodes&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        nodes[n] = nodes[<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->];<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->for<!-- raw HTML omitted --><!-- raw HTML omitted --> (<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> i=<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->; i&lt;n; i++) {<!-- raw HTML omitted -->            nodes[i].connect(nodes[i+<!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->]);<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->interface<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        String getType();<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> StartMessage <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> String getType() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;START&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> String getType() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;STOP&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->;            <!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> CancelMessage <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> String getType() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;CANCEL&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> nodeId;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> value;<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> nodeId, <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> value) {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->.nodeId = nodeId;<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->.value = value;<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> String getType() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;TOKEN&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Runnable {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> nodeId;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer timer;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode nextNode;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> BlockingQueue&lt;Message&gt; queue = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> LinkedBlockingQueue&lt;Message&gt;();<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->boolean<!-- raw HTML omitted --><!-- raw HTML omitted --> isActive = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        <!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> id, Timer timer, RingNode nextNode) {<!-- raw HTML omitted -->            nodeId = id;<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->.timer = timer;<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->.nextNode = nextNode;                        <!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> connect(RingNode node) {<!-- raw HTML omitted -->            nextNode = node;<!-- raw HTML omitted -->            isActive = <!-- raw HTML omitted --><!-- raw HTML omitted -->true<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> sendMessage(Message m) {<!-- raw HTML omitted -->            queue.add(m);<!-- raw HTML omitted -->            executor.execute(<!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> run() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (isActive) {<!-- raw HTML omitted -->                <!-- raw HTML omitted --><!-- raw HTML omitted -->try<!-- raw HTML omitted --><!-- raw HTML omitted --> {<!-- raw HTML omitted -->                    Message m = queue.take();<!-- raw HTML omitted -->                    <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> StartMessage) {<!-- raw HTML omitted -->                        log(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Starting messages&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->                        timer.sendMessage(m);<!-- raw HTML omitted -->                        nextNode.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage(nodeId, <!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->));<!-- raw HTML omitted -->                    } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage) {<!-- raw HTML omitted -->                        log(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Stopping&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->                        nextNode.sendMessage(m);<!-- raw HTML omitted -->                        isActive = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                        <!-- raw HTML omitted -->//<!-- raw HTML omitted --><!-- raw HTML omitted -->                    } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage) {<!-- raw HTML omitted -->                        <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (((TokenMessage)m).nodeId == nodeId) {<!-- raw HTML omitted -->                            <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> nextValue = ((TokenMessage)m).value + <!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                            <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (nextValue % <!-- raw HTML omitted --><!-- raw HTML omitted -->10000<!-- raw HTML omitted --><!-- raw HTML omitted --> == <!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->) {<!-- raw HTML omitted -->                                log(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Around ring &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+nextValue+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; times&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->                            }<!-- raw HTML omitted -->                            <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (nextValue == <!-- raw HTML omitted --><!-- raw HTML omitted -->1000000<!-- raw HTML omitted --><!-- raw HTML omitted -->) {<!-- raw HTML omitted -->                                timer.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage());<!-- raw HTML omitted -->                                timer.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> CancelMessage());<!-- raw HTML omitted -->                                nextNode.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage());<!-- raw HTML omitted -->                                isActive = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                            } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> {<!-- raw HTML omitted -->                                nextNode.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage(nodeId, nextValue));<!-- raw HTML omitted -->                            }<!-- raw HTML omitted --><!-- raw HTML omitted -->                        } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> {<!-- raw HTML omitted -->                            nextNode.sendMessage(m);<!-- raw HTML omitted -->                        }<!-- raw HTML omitted -->                    }<!-- raw HTML omitted --><!-- raw HTML omitted -->                } <!-- raw HTML omitted --><!-- raw HTML omitted -->catch<!-- raw HTML omitted --><!-- raw HTML omitted --> (InterruptedException ie) {<!-- raw HTML omitted -->                    ie.printStackTrace();<!-- raw HTML omitted -->                }<!-- raw HTML omitted -->            }<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> log(String s) {<!-- raw HTML omitted -->            System.out.println(System.currentTimeMillis()+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+nodeId+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;: &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+s);<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Runnable {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> BlockingQueue&lt;Message&gt; queue = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> LinkedBlockingQueue&lt;Message&gt;();<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->boolean<!-- raw HTML omitted --><!-- raw HTML omitted --> timing = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->long<!-- raw HTML omitted --><!-- raw HTML omitted --> startTime;<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> sendMessage(Message m) {<!-- raw HTML omitted -->            <!-- raw HTML omitted -->//we don&rsquo;t need to change this implementation as timer is rarely called<!-- raw HTML omitted --><!-- raw HTML omitted -->            queue.add(m);<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> run() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->while<!-- raw HTML omitted --><!-- raw HTML omitted --> (<!-- raw HTML omitted --><!-- raw HTML omitted -->true<!-- raw HTML omitted --><!-- raw HTML omitted -->) {<!-- raw HTML omitted -->                Message m;<!-- raw HTML omitted -->                <!-- raw HTML omitted --><!-- raw HTML omitted -->try<!-- raw HTML omitted --><!-- raw HTML omitted --> {<!-- raw HTML omitted -->                    m = queue.take();<!-- raw HTML omitted -->                    <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> StartMessage) {<!-- raw HTML omitted -->                        startTime = System.currentTimeMillis();<!-- raw HTML omitted -->                        timing = <!-- raw HTML omitted --><!-- raw HTML omitted -->true<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                    } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage) {<!-- raw HTML omitted -->                        <!-- raw HTML omitted --><!-- raw HTML omitted -->long<!-- raw HTML omitted --><!-- raw HTML omitted --> end = System.currentTimeMillis();<!-- raw HTML omitted -->                        System.out.println(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Start=&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+startTime+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; Stop=&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+end+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; Elapsed=&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+(end-startTime));<!-- raw HTML omitted -->                        timing = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;                                        <!-- raw HTML omitted -->                    } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> CancelMessage) {<!-- raw HTML omitted -->                        <!-- raw HTML omitted --><!-- raw HTML omitted -->break<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                    }<!-- raw HTML omitted -->                } <!-- raw HTML omitted --><!-- raw HTML omitted -->catch<!-- raw HTML omitted --><!-- raw HTML omitted --> (InterruptedException e) {<!-- raw HTML omitted -->                    e.printStackTrace();<!-- raw HTML omitted -->                }<!-- raw HTML omitted -->            }<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted -->}<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Code<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Spawn<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Send 100M messages<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Scala Actors<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->15ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->270104ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->SimpleRing<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->11ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->493073ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->OptimizedRing (4 threads)<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->6ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->84727ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->OptimizedRing (5+ threads)<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->5ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->62593ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->OptimizedRing (1 thread)<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->5ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->60660ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->I finally saw my 4 cores used! Max multithreaded throughput is achieved at 5 threads. However 1 thread is faster. Is this related to memory bandwith limit?<!-- raw HTML omitted --><!-- raw HTML omitted -->Now I am left wondering if actors are really that important if one can achieve much higher throughput using plain Java and very simple concepts (BlockingQueue, ThreadPoolExecutor). Worse, this test is actually faster with only 1 thread&hellip;</p>

</div>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "chasethedevil" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>

    
      
    
  </body>
</html>
