<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Running Rings Around Plain Java - The Killer Code &middot; Chase the Devil</title>

  
  <link href="https://fonts.googleapis.com/css?family=UnifrakturMaguntia" rel="stylesheet">  
  <link rel="stylesheet" href="https:///css/poole.css">
  <link rel="stylesheet" href="https:///css/hyde.css">
  <link rel="stylesheet" href="https:///css/poole-overrides.css">
  <link rel="stylesheet" href="https:///css/hyde-overrides.css">
  <link rel="stylesheet" href="https:///css/hyde-x.css">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https:///touch-icon-144-precomposed.png">
  <link href="https:///favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="">
  <meta name="keywords" content="">
  
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-365717-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body class="theme-base-00">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>Chase the Devil</h1>
      <p class="lead">out of tech&hellip;</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https:///">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="https:///chasethedevil.github.io/about/">About</a></li>
      
      <li class="sidebar-nav-item"><a href="https:///chasethedevil.github.io/post/">Posts</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <script type="text/javascript">document.write("<a href=\"mail" + "to:" + new Array("fabien","2ipi.com").join("@") + "?subject=your%20blog\">" + '<i class="fa fa-envelope fa-3x"></i>' + "</" + "a>");</script>  
      
      
      
      
      
      
      <a href="https://twitter.com/logos01"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="https:///index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

    
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Running Rings Around Plain Java - The Killer Code</h1>
    <span class="post-date">Jan 8, 2009 &middot; 2 minute read &middot; <a href="https:///chasethedevil.github.io/post/running-rings-around-plain-java-the-killer-code/#disqus_thread">Comments</a>
    </span>
    <p>I wrote my <!-- raw HTML omitted -->previous<!-- raw HTML omitted --> post too fast. I found a very simple change that increases the speed x6!<!-- raw HTML omitted --><!-- raw HTML omitted -->The idea is too process messages in a ThreadPoolExecutor. As my Nodes are Runnable, I just needed to initialize a common ThreadPoolExecutor, and in a sendMessage, execute the runnable each time.<!-- raw HTML omitted --><!-- raw HTML omitted -->Here is the full code:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> OptimizedRing {<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> ExecutorService executor;<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> main(String[] args) <!-- raw HTML omitted --><!-- raw HTML omitted -->throws<!-- raw HTML omitted --><!-- raw HTML omitted --> Exception {<!-- raw HTML omitted -->        OptimizedRing ring = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> OptimizedRing();<!-- raw HTML omitted -->        RingNode node = ring.startRing(Integer.parseInt(args[<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->]));<!-- raw HTML omitted -->        node.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> StartMessage());<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode startRing(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> n) {<!-- raw HTML omitted -->        RingNode[] nodes = spawnNodes(n, startTimer());<!-- raw HTML omitted -->        connectNodes(n, nodes);<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> nodes[<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->];<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer startTimer() {<!-- raw HTML omitted -->        Timer timer = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer();<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> Thread(timer).start();<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> timer;<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode[] spawnNodes(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> n, <!-- raw HTML omitted --><!-- raw HTML omitted -->final<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer timer) {<!-- raw HTML omitted -->        System.out.println(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;constructing nodes&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->long<!-- raw HTML omitted --><!-- raw HTML omitted --> start = System.currentTimeMillis();<!-- raw HTML omitted -->        executor = Executors.newFixedThreadPool(<!-- raw HTML omitted --><!-- raw HTML omitted -->4<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        RingNode[] nodes = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode[n+<!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->];<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->for<!-- raw HTML omitted --><!-- raw HTML omitted --> (<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> i = <!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->; i &lt; n ; i++) {<!-- raw HTML omitted -->            nodes[i] = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode(i, timer, <!-- raw HTML omitted --><!-- raw HTML omitted -->null<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->long<!-- raw HTML omitted --><!-- raw HTML omitted --> end = System.currentTimeMillis();<!-- raw HTML omitted -->        System.out.println(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Took &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+(end-start)+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;ms to construct &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+n+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; nodes&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> nodes;<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> connectNodes(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> n, RingNode[] nodes) {<!-- raw HTML omitted -->        System.out.println(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;connecting nodes&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        nodes[n] = nodes[<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->];<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->for<!-- raw HTML omitted --><!-- raw HTML omitted --> (<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> i=<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->; i&lt;n; i++) {<!-- raw HTML omitted -->            nodes[i].connect(nodes[i+<!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->]);<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->interface<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        String getType();<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> StartMessage <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> String getType() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;START&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> String getType() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;STOP&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->;            <!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> CancelMessage <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> String getType() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;CANCEL&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Message {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> nodeId;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> value;<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> nodeId, <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> value) {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->.nodeId = nodeId;<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->.value = value;<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> String getType() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->return<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;TOKEN&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Runnable {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> nodeId;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer timer;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode nextNode;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> BlockingQueue&lt;Message&gt; queue = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> LinkedBlockingQueue&lt;Message&gt;();<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->boolean<!-- raw HTML omitted --><!-- raw HTML omitted --> isActive = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        <!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> RingNode(<!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> id, Timer timer, RingNode nextNode) {<!-- raw HTML omitted -->            nodeId = id;<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->.timer = timer;<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->.nextNode = nextNode;                        <!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> connect(RingNode node) {<!-- raw HTML omitted -->            nextNode = node;<!-- raw HTML omitted -->            isActive = <!-- raw HTML omitted --><!-- raw HTML omitted -->true<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> sendMessage(Message m) {<!-- raw HTML omitted -->            queue.add(m);<!-- raw HTML omitted -->            executor.execute(<!-- raw HTML omitted --><!-- raw HTML omitted -->this<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> run() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (isActive) {<!-- raw HTML omitted -->                <!-- raw HTML omitted --><!-- raw HTML omitted -->try<!-- raw HTML omitted --><!-- raw HTML omitted --> {<!-- raw HTML omitted -->                    Message m = queue.take();<!-- raw HTML omitted -->                    <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> StartMessage) {<!-- raw HTML omitted -->                        log(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Starting messages&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->                        timer.sendMessage(m);<!-- raw HTML omitted -->                        nextNode.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage(nodeId, <!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->));<!-- raw HTML omitted -->                    } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage) {<!-- raw HTML omitted -->                        log(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Stopping&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->                        nextNode.sendMessage(m);<!-- raw HTML omitted -->                        isActive = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                        <!-- raw HTML omitted -->//<!-- raw HTML omitted --><!-- raw HTML omitted -->                    } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage) {<!-- raw HTML omitted -->                        <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (((TokenMessage)m).nodeId == nodeId) {<!-- raw HTML omitted -->                            <!-- raw HTML omitted --><!-- raw HTML omitted -->int<!-- raw HTML omitted --><!-- raw HTML omitted --> nextValue = ((TokenMessage)m).value + <!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                            <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (nextValue % <!-- raw HTML omitted --><!-- raw HTML omitted -->10000<!-- raw HTML omitted --><!-- raw HTML omitted --> == <!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->) {<!-- raw HTML omitted -->                                log(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Around ring &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+nextValue+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; times&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted -->                            }<!-- raw HTML omitted -->                            <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (nextValue == <!-- raw HTML omitted --><!-- raw HTML omitted -->1000000<!-- raw HTML omitted --><!-- raw HTML omitted -->) {<!-- raw HTML omitted -->                                timer.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage());<!-- raw HTML omitted -->                                timer.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> CancelMessage());<!-- raw HTML omitted -->                                nextNode.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage());<!-- raw HTML omitted -->                                isActive = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                            } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> {<!-- raw HTML omitted -->                                nextNode.sendMessage(<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> TokenMessage(nodeId, nextValue));<!-- raw HTML omitted -->                            }<!-- raw HTML omitted --><!-- raw HTML omitted -->                        } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> {<!-- raw HTML omitted -->                            nextNode.sendMessage(m);<!-- raw HTML omitted -->                        }<!-- raw HTML omitted -->                    }<!-- raw HTML omitted --><!-- raw HTML omitted -->                } <!-- raw HTML omitted --><!-- raw HTML omitted -->catch<!-- raw HTML omitted --><!-- raw HTML omitted --> (InterruptedException ie) {<!-- raw HTML omitted -->                    ie.printStackTrace();<!-- raw HTML omitted -->                }<!-- raw HTML omitted -->            }<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> log(String s) {<!-- raw HTML omitted -->            System.out.println(System.currentTimeMillis()+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+nodeId+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;: &quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+s);<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->    }<!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->static<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->class<!-- raw HTML omitted --><!-- raw HTML omitted --> Timer <!-- raw HTML omitted --><!-- raw HTML omitted -->implements<!-- raw HTML omitted --><!-- raw HTML omitted --> Runnable {<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> BlockingQueue&lt;Message&gt; queue = <!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted --> LinkedBlockingQueue&lt;Message&gt;();<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->boolean<!-- raw HTML omitted --><!-- raw HTML omitted --> timing = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->private<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->long<!-- raw HTML omitted --><!-- raw HTML omitted --> startTime;<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> sendMessage(Message m) {<!-- raw HTML omitted -->            <!-- raw HTML omitted -->//we don&rsquo;t need to change this implementation as timer is rarely called<!-- raw HTML omitted --><!-- raw HTML omitted -->            queue.add(m);<!-- raw HTML omitted -->        }<!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->public<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->void<!-- raw HTML omitted --><!-- raw HTML omitted --> run() {<!-- raw HTML omitted -->            <!-- raw HTML omitted --><!-- raw HTML omitted -->while<!-- raw HTML omitted --><!-- raw HTML omitted --> (<!-- raw HTML omitted --><!-- raw HTML omitted -->true<!-- raw HTML omitted --><!-- raw HTML omitted -->) {<!-- raw HTML omitted -->                Message m;<!-- raw HTML omitted -->                <!-- raw HTML omitted --><!-- raw HTML omitted -->try<!-- raw HTML omitted --><!-- raw HTML omitted --> {<!-- raw HTML omitted -->                    m = queue.take();<!-- raw HTML omitted -->                    <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> StartMessage) {<!-- raw HTML omitted -->                        startTime = System.currentTimeMillis();<!-- raw HTML omitted -->                        timing = <!-- raw HTML omitted --><!-- raw HTML omitted -->true<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                    } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> StopMessage) {<!-- raw HTML omitted -->                        <!-- raw HTML omitted --><!-- raw HTML omitted -->long<!-- raw HTML omitted --><!-- raw HTML omitted --> end = System.currentTimeMillis();<!-- raw HTML omitted -->                        System.out.println(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;Start=&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+startTime+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; Stop=&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+end+<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot; Elapsed=&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->+(end-startTime));<!-- raw HTML omitted -->                        timing = <!-- raw HTML omitted --><!-- raw HTML omitted -->false<!-- raw HTML omitted --><!-- raw HTML omitted -->;                                        <!-- raw HTML omitted -->                    } <!-- raw HTML omitted --><!-- raw HTML omitted -->else<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->if<!-- raw HTML omitted --><!-- raw HTML omitted --> (m <!-- raw HTML omitted --><!-- raw HTML omitted -->instanceof<!-- raw HTML omitted --><!-- raw HTML omitted --> CancelMessage) {<!-- raw HTML omitted -->                        <!-- raw HTML omitted --><!-- raw HTML omitted -->break<!-- raw HTML omitted --><!-- raw HTML omitted -->;<!-- raw HTML omitted -->                    }<!-- raw HTML omitted -->                } <!-- raw HTML omitted --><!-- raw HTML omitted -->catch<!-- raw HTML omitted --><!-- raw HTML omitted --> (InterruptedException e) {<!-- raw HTML omitted -->                    e.printStackTrace();<!-- raw HTML omitted -->                }<!-- raw HTML omitted -->            }<!-- raw HTML omitted -->        }<!-- raw HTML omitted -->    }<!-- raw HTML omitted -->}<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Code<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Spawn<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Send 100M messages<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Scala Actors<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->15ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->270104ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->SimpleRing<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->11ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->493073ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->OptimizedRing (4 threads)<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->6ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->84727ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->OptimizedRing (5+ threads)<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->5ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->62593ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->OptimizedRing (1 thread)<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->5ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->60660ms<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->I finally saw my 4 cores used! Max multithreaded throughput is achieved at 5 threads. However 1 thread is faster. Is this related to memory bandwith limit?<!-- raw HTML omitted --><!-- raw HTML omitted -->Now I am left wondering if actors are really that important if one can achieve much higher throughput using plain Java and very simple concepts (BlockingQueue, ThreadPoolExecutor). Worse, this test is actually faster with only 1 thread&hellip;</p>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "chasethedevil";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "chasethedevil";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<div class="content container" style="padding-top: 0rem;"-->
 <a href="https://twitter.com/share" class="twitter-share-button"{count} data-hashtags="chasethedevil" data-size="large">Tweet</a>
 <a style="font-size:75%;" href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false"><i class="fa fa-reddit fa-2x" aria-hidden="true"></i>Submit to reddit</a> 
<table style="border-collapse: collapse;">
     <tr style="padding: 0px; margin: 0px; border: none;">
     <td style="vertical-align: middle;padding: 0px; margin: 0px; border: none;font-size: 60%;">&copy; 2006-16 <a href="http://chasethedevil.github.io/about/">Fabien</a></td>
     <td style="vertical-align: middle;padding: 0px; margin: 0px; border: none;font-size: 0px;"><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding: 0px; margin: 0px; border: none;" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a></td>
     <td style="vertical-align: middle;padding: 0px; margin: 0px; border: none;font-size: 60%;">This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</td></tr></table>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>

</body>
</html>

